<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hỗ trợ - Liên hệ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css(v=${#dates.createNow().time})}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* === Z-INDEX FIX FOR HEADER DROPDOWNS === */
        .site-header-user {
            position: relative;
            z-index: 1000 !important;
        }
        .site-header-user .submenu,
        .site-header-user #notifDropdown {
            z-index: 1001 !important;
        }
        /* === END Z-INDEX FIX === */
    </style>

</head>
<body>

<div th:insert="user/header-user :: site-header-user"></div>


<main class="contact">
    <div class="container">
        <div class="contact-form-wrapper">
            <div class="form-card">
                <div class="form-header">
                    <h1 class="form-title">Gửi yêu cầu hỗ trợ</h1>
                    <p class="form-subtitle">Điền thông tin dưới đây để chúng tôi có thể hỗ trợ bạn tốt nhất</p>
                </div>

                <form class="contact-form" method="POST" novalidate>
                    <label class="field">
                        <span class="label">Email <span class="required">*</span></span>
                        <input type="email" name="email" placeholder="email@example.com" required
                               value="">
                    </label>


                    <label class="field">
                        <span class="label">Tiêu đề <span class="required">*</span></span>
                        <input type="text" name="subject" placeholder="Mô tả ngắn gọn vấn đề của bạn" required
                               value="">
                    </label>

                    <label class="field">
                        <span class="label">Nội dung chi tiết <span class="required">*</span></span>
                        <textarea name="message" rows="6" placeholder="Mô tả chi tiết vấn đề, lỗi gặp phải hoặc yêu cầu hỗ trợ..." required></textarea>
                    </label>

                    <button type="submit" class="submit-button">
                        <span class="button-text">Gửi yêu cầu hỗ trợ</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>

<div th:insert="footer :: site-footer"></div>




<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector(".contact-form");

        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            const email = form.querySelector('input[name="email"]').value.trim();
            const subject = form.querySelector('input[name="subject"]').value.trim();
            const message = form.querySelector('textarea[name="message"]').value.trim();

            if (!email || !subject || !message) {
                Swal.fire({
                    icon: "warning",
                    title: "Thiếu thông tin",
                    text: "Vui lòng nhập đầy đủ các trường bắt buộc."
                });
                return;
            }

            try {
                const response = await fetch(
                    `/api/support?subject=${encodeURIComponent(subject)}&message=${encodeURIComponent(message)}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                    }
                );

                if (!response.ok) {
                    const errorText = await response.text().catch(() => "Lỗi không xác định.");
                    throw new Error(errorText);
                }

                Swal.fire({
                    icon: "success",
                    title: "Đã gửi thành công",
                    text: "Chúng tôi đã nhận được yêu cầu hỗ trợ của bạn."
                });

                form.reset();

            } catch (err) {
                Swal.fire({
                    icon: "error",
                    title: "Lỗi gửi yêu cầu",
                    text: err.message || "Không thể kết nối đến API."
                });
            }
        });
    });
</script>


</body>
</html>
