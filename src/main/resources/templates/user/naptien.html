<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Nạp tiền - VinFast</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/style.css(v=${#dates.createNow().time})}">

    <style>
        /* Enhanced Typography System */
        :root {
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-display: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Recharge Page Specific Styles */
        .recharge-page {
            min-height: calc(100vh - 200px);
            padding: 40px 0 60px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-family: var(--font-primary);
        }

        .recharge-wrapper {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-family: var(--font-display);
            font-size: 36px;
            font-weight: 700;
            color: #0f172a;
            margin: 0 0 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .page-subtitle {
            color: #64748b;
            font-size: 17px;
            margin: 0;
            font-weight: 400;
            letter-spacing: -0.01em;
            line-height: 1.6;
        }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #86efac;
            border-radius: 20px;
            padding: 28px 32px;
            margin-bottom: 32px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }

        .balance-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .balance-label {
            font-family: var(--font-primary);
            font-size: 13px;
            color: #059669;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .balance-amount {
            font-family: var(--font-display);
            font-size: 42px;
            font-weight: 800;
            color: #047857;
            letter-spacing: -0.03em;
            line-height: 1;
        }

        /* Card Styles */
        .recharge-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 36px;
            box-shadow: 0 4px 20px rgba(15, 23, 42, 0.06);
            margin-bottom: 24px;
        }

        .card-title {
            font-family: var(--font-display);
            font-size: 22px;
            font-weight: 700;
            color: #0f172a;
            margin: 0 0 28px;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.02em;
            line-height: 1.3;
        }

        /* Amount Selection */
        .amount-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
            margin-bottom: 20px;
        }

        .amount-btn {
            padding: 18px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 14px;
            font-family: var(--font-primary);
            font-size: 16px;
            font-weight: 600;
            color: #475569;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            letter-spacing: -0.01em;
        }

        .amount-btn:hover {
            border-color: #0ea5e9;
            background: #f0f9ff;
            color: #0284c7;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
        }

        .amount-btn.active {
            border-color: #0ea5e9;
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            color: white;
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.35);
            transform: translateY(-2px);
        }

        /* Custom Amount Input */
        .custom-amount {
            margin-top: 20px;
        }

        .custom-amount input {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            font-family: var(--font-primary);
            font-size: 16px;
            font-weight: 500;
            color: #0f172a;
            transition: all 0.3s ease;
            letter-spacing: -0.01em;
        }

        .custom-amount input::placeholder {
            color: #94a3b8;
            font-weight: 400;
        }

        .custom-amount input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
            background: white;
        }

        /* Bank Info */
        .bank-info {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 2px dashed #cbd5e1;
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .bank-name {
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 1px solid #e2e8f0;
            letter-spacing: -0.01em;
        }

        .bank-detail {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            gap: 16px;
        }

        .bank-detail-label {
            font-family: var(--font-primary);
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
            letter-spacing: -0.005em;
        }

        .bank-detail-value {
            font-family: var(--font-mono);
            font-size: 16px;
            font-weight: 600;
            color: #0f172a;
            letter-spacing: 0.02em;
        }

        .copy-btn {
            padding: 8px 14px;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 8px;
            font-family: var(--font-primary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.01em;
        }

        .copy-btn:hover {
            background: #0284c7;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .copy-btn.copied {
            background: #22c55e;
        }

        /* QR Section */
        .qr-section {
            text-align: center;
            padding: 28px;
            background: white;
            border-radius: 14px;
            border: 2px solid #e2e8f0;
        }

        .qr-section h4 {
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .qr-container {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 14px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .qr-container img {
            max-width: 250px;
            height: auto;
            border-radius: 10px;
        }

        /* Instructions */
        .instructions-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #fbbf24;
            border-radius: 14px;
            padding: 24px;
            margin-top: 24px;
        }

        .instructions-title {
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 700;
            color: #92400e;
            margin: 0 0 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.01em;
        }

        .instructions-box ol {
            margin: 0;
            padding-left: 24px;
            color: #78350f;
            font-family: var(--font-primary);
        }

        .instructions-box li {
            margin: 10px 0;
            line-height: 1.7;
            font-size: 15px;
            font-weight: 400;
            letter-spacing: -0.005em;
        }

        /* Result Section */
        .result-section {
            display: none;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .result-section.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(24px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-header {
            text-align: center;
            padding: 32px;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-radius: 16px;
            margin-bottom: 28px;
        }

        .success-icon {
            font-size: 56px;
            margin-bottom: 16px;
            line-height: 1;
        }

        .success-title {
            font-family: var(--font-display);
            font-size: 28px;
            font-weight: 700;
            color: #059669;
            margin: 0 0 10px;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .success-subtitle {
            font-family: var(--font-primary);
            color: #64748b;
            margin: 0;
            font-size: 16px;
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        /* Bank Selection */
        .bank-selection {
            margin: 28px 0;
        }

        .bank-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }

        .bank-option {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .bank-option:hover {
            border-color: #0ea5e9;
            background: #f0f9ff;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(14, 165, 233, 0.12);
        }

        .bank-option.selected {
            border-color: #0ea5e9;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.25);
            transform: translateY(-3px);
        }

        .bank-option-name {
            font-family: var(--font-display);
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 6px;
            font-size: 15px;
            letter-spacing: -0.01em;
        }

        .bank-option-number {
            font-family: var(--font-mono);
            font-size: 15px;
            color: #64748b;
            letter-spacing: 0.02em;
            font-weight: 500;
        }

        /* Submit Button Enhancement */
        .submit-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 18px 24px;
            margin-top: 28px;
            border: none;
            border-radius: 14px;
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            color: white;
            font-family: var(--font-display);
            font-size: 17px;
            font-weight: 700;
            letter-spacing: -0.01em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.4);
            background: linear-gradient(135deg, #0284c7, #2563eb);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .recharge-page {
                padding: 24px 0 40px;
            }

            .page-title {
                font-size: 28px;
                gap: 10px;
            }

            .page-subtitle {
                font-size: 15px;
            }

            .balance-amount {
                font-size: 34px;
            }

            .recharge-card {
                padding: 24px;
            }

            .card-title {
                font-size: 20px;
            }

            .amount-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .amount-btn {
                font-size: 15px;
                padding: 16px 12px;
            }

            .qr-container img {
                max-width: 220px;
            }

            .success-title {
                font-size: 24px;
            }

            .instructions-box li {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 24px;
                flex-direction: column;
                gap: 8px;
            }

            .balance-amount {
                font-size: 28px;
            }

            .amount-grid {
                grid-template-columns: 1fr;
            }

            .bank-options {
                grid-template-columns: 1fr;
            }

            .bank-detail {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<div th:insert="user/header-user :: site-header-user"></div>

<main class="recharge-page">
    <div class="container recharge-wrapper">

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">
                Nạp tiền vào tài khoản
            </h1>
            <p class="page-subtitle">Nạp tiền nhanh chóng để sử dụng dịch vụ thuê pin VinFast</p>
        </div>

        <!-- Balance Display -->
        <div class="balance-card">
            <div class="balance-label">Số dư hiện tại</div>
            <div th:text="${balance_amount}" class="balance-amount" id="balanceAmount">0 VNĐ</div>
        </div>

        <!-- Recharge Form -->
        <div class="recharge-card">
            <h3 class="card-title">
                Chọn số tiền nạp
            </h3>

            <form id="rechargeForm">
                <div class="amount-grid" id="amountButtons">
                    <button type="button" class="amount-btn" data-amount="50000">50,000 VNĐ</button>
                    <button type="button" class="amount-btn" data-amount="100000">100,000 VNĐ</button>
                    <button type="button" class="amount-btn" data-amount="200000">200,000 VNĐ</button>
                    <button type="button" class="amount-btn" data-amount="500000">500,000 VNĐ</button>
                    <button type="button" class="amount-btn" data-amount="1000000">1,000,000 VNĐ</button>
                    <button type="button" class="amount-btn" data-amount="2000000">2,000,000 VNĐ</button>
                </div>

                <div class="custom-amount">
                    <input
                            type="number"
                            name="amount"
                            id="amountInput"
                            placeholder="Hoặc nhập số tiền tùy chỉnh (10,000 - 10,000,000 VNĐ)"
                            min="10000"
                            max="10000000"
                    />
                </div>

                <button type="submit" class="submit-btn">
                    <span>Tạo yêu cầu nạp tiền</span>
                    <span>→</span>
                </button>
            </form>
        </div>

        <!-- Bank Information -->
        <div class="recharge-card">
            <h3 class="card-title">
                Thông tin chuyển khoản
            </h3>

            <div id="bankCards"></div>

            <div class="instructions-box">
                <h4 class="instructions-title">
                    Hướng dẫn nạp tiền
                </h4>
                <ol>
                    <li>Chọn số tiền muốn nạp từ các mức có sẵn hoặc nhập số tiền tùy chỉnh</li>
                    <li>Nhấn "Tạo yêu cầu nạp tiền" để sinh QR Code</li>
                    <li>Quét QR Code hoặc chuyển khoản thủ công theo thông tin trên</li>
                    <li>Đảm bảo nội dung chuyển khoản chính xác</li>
                    <li>Liên hệ admin để xác nhận nạp tiền</li>
                </ol>
            </div>
        </div>

        <!-- Result Section -->
        <div class="result-section" id="rechargeResult">
            <div class="success-header">
                <div class="success-icon">✅</div>
                <h3 class="success-title">Yêu cầu nạp tiền đã được tạo!</h3>
                <p class="success-subtitle">Vui lòng chuyển khoản theo thông tin bên dưới</p>
            </div>

            <div class="recharge-card">
                <div id="resultInfo"></div>

                <div class="bank-selection">
                    <h4 class="card-title">
                        Chọn ngân hàng để chuyển khoản
                    </h4>
                    <div class="bank-options" id="bankOptions"></div>
                </div>

                <div class="qr-section">
                    <h4 style="margin: 0 0 20px; color: #0f172a;">
                        Quét QR Code để chuyển khoản
                    </h4>
                    <div class="qr-container">
                        <img id="qrCodeImage" src="" alt="QR Code chuyển khoản" />
                    </div>
                </div>

                <div class="instructions-box" style="margin-top: 28px;">
                    <h4 class="instructions-title">
                        <span>⚠️</span>
                        Lưu ý quan trọng
                    </h4>
                    <ol>
                        <li>Kiểm tra kỹ thông tin tài khoản và số tiền trước khi chuyển</li>
                        <li>Không thay đổi nội dung chuyển khoản để tránh xử lý chậm</li>
                        <li>Chụp lại biên lai chuyển khoản để đối chiếu nếu cần</li>
                        <li>Tiền sẽ được cộng vào tài khoản sau khi admin xác nhận</li>
                    </ol>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Footer -->
<div th:insert="footer :: site-footer"></div>

<script th:src="@{/js/notifications.js}"></script>
<script>
    const paymentInfos = [
        {
            id: 1,
            bank_name: "ACB - Ngân hàng Á Châu",
            account_number: "22749061",
            account_holder: "HUYNH MAI NHAT MINH",
            qr_code_url: ""
        },
    ];

    // DOM Elements
    const amountButtons = document.querySelectorAll(".amount-btn");
    const amountInput = document.getElementById("amountInput");
    const rechargeForm = document.getElementById("rechargeForm");
    const bankCards = document.getElementById("bankCards");

    // Render Bank Cards
    function renderBankCards() {
        bankCards.innerHTML = "";
        paymentInfos.forEach((bank) => {
            const card = document.createElement("div");
            card.className = "bank-info";
            card.innerHTML = `
                    <div class="bank-name">${bank.bank_name}</div>
                    <div class="bank-detail">
                        <span class="bank-detail-label">Số tài khoản:</span>
                        <span class="bank-detail-value" id="account-${bank.id}">${bank.account_number}</span>
                        <button type="button" class="copy-btn" onclick="copyText('account-${bank.id}', this)">Copy</button>
                    </div>
                    <div class="bank-detail">
                        <span class="bank-detail-label">Chủ tài khoản:</span>
                        <span class="bank-detail-value">${bank.account_holder}</span>
                    </div>
                `;
            bankCards.appendChild(card);
        });
    }
    renderBankCards();

    // Amount Button Handlers
    amountButtons.forEach((button) => {
        button.addEventListener("click", function () {
            amountButtons.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            amountInput.value = this.dataset.amount;
        });
    });

    amountInput.addEventListener("input", function () {
        amountButtons.forEach((b) => b.classList.remove("active"));
    });

    // Copy Function
    function copyText(elementId, button) {
        const element = document.getElementById(elementId);
        const text = element.textContent.trim();

        navigator.clipboard.writeText(text).then(() => {
            const originalText = button.textContent;
            button.textContent = "✓ Đã copy";
            button.classList.add("copied");

            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove("copied");
            }, 2000);
        }).catch(() => {
            alert("Không thể copy. Vui lòng copy thủ công.");
        });
    }

    // Form Submit
    rechargeForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const amount = Number(amountInput.value);

        if (!amount || amount < 10000) {
            alert("Số tiền nạp tối thiểu là 10,000 VNĐ");
            return;
        }
        if (amount > 10000000) {
            alert("Số tiền nạp tối đa là 10,000,000 VNĐ");
            return;
        }

        const formData = new FormData(this);
        const response = await fetch("/qr", {
            method: "POST",
            body: formData
        });

        const qrUrl = await response.text();
        showRechargeResult(amount, qrUrl);
    });

    // Show Result
    function showRechargeResult(amount, qrUrl) {
        const resultInfo = document.getElementById("resultInfo");
        const bankOptions = document.getElementById("bankOptions");
        const rechargeResult = document.getElementById("rechargeResult");

        resultInfo.innerHTML = `
                <div class="bank-info">
                    <div class="bank-detail">
                        <span class="bank-detail-label">Số tiền nạp:</span>
                        <span class="bank-detail-value" style="color: #059669; font-size: 20px;">
                            ${parseInt(amount, 10).toLocaleString("vi-VN")} VNĐ
                        </span>
                    </div>
                </div>
            `;

        bankOptions.innerHTML = "";
        paymentInfos.forEach((bank, idx) => {
            const option = document.createElement("div");
            option.className = "bank-option";
            option.innerHTML = `
                    <div class="bank-option-name">${bank.bank_name}</div>
                    <div class="bank-option-number">${bank.account_number}</div>
                `;

            option.addEventListener("click", function () {
                document.querySelectorAll(".bank-option").forEach((el) => el.classList.remove("selected"));
                this.classList.add("selected");
                updateQRCode(qrUrl);
            });

            bankOptions.appendChild(option);
            if (idx === 0) {
                option.classList.add("selected");
                updateQRCode(qrUrl);
            }
        });

        rechargeResult.classList.add("show");
        rechargeResult.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // Update QR Code
    function updateQRCode(qrUrl) {
        const img = document.getElementById("qrCodeImage");
        img.src = qrUrl;
        img.alt = "QR Code chuyển khoản";
    }
</script>
</body>
</html>