<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments/_header :: common_header(${transaction.id == null ? 'Tạo Giao Dịch Mới' : 'Chỉnh Sửa Giao Dịch'})}"></head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
    <nav th:replace="~{admin/fragments/_header :: navbar}"></nav>
    <aside th:replace="~{admin/fragments/_header :: sidebar('transactions')}"></aside>
    <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 th:text="${transaction.id == null ? 'Tạo Giao Dịch Mới' : 'Chỉnh Sửa Giao Dịch'}"></h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Home</a></li>
                            <li class="breadcrumb-item"><a th:href="@{/admin/transactions}">Giao dịch Pin</a></li>
                            <li class="breadcrumb-item active" th:text="${transaction.id == null ? 'Tạo Mới' : 'Chỉnh Sửa'}"></li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>
        <section class="content">
            <div class="container-fluid">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">Thông tin giao dịch</h3>
                    </div>
                    <form th:action="${transaction.id == null} ? @{/admin/transactions} : @{/admin/transactions/update/{id}(id=${transaction.id})}" th:object="${transaction}" method="post">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="user">Người Dùng</label>
                                        <select class="form-control" id="user" th:field="*{user}" required>
                                            <option value="">-- Chọn người dùng --</option>
                                            <option th:each="u : ${users.content}" th:value="${u.id}" th:text="${u.username} + ' (' + ${u.fullName} + ')'"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="station">Trạm Giao Dịch</label>
                                        <select class="form-control" id="station" th:field="*{station}" required>
                                            <option value="">-- Chọn trạm --</option>
                                            <option th:each="st : ${stations}" th:value="${st.id}" th:text="${st.name}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="batteryIn">Pin Cũ (Pin trả vào)</label>
                                        <select class="form-control" id="batteryIn" th:field="*{batteryIn}" required>
                                            <option value="">-- Chọn pin cũ --</option>
                                            <option th:each="bat : ${batteries.content}" th:value="${bat.id}" th:text="${bat.nameBattery} + ' (' + ${bat.status} + ')'"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="batteryOut">Pin Mới (Pin lấy ra)</label>
                                        <select class="form-control" id="batteryOut" th:field="*{batteryOut}" required>
                                            <option value="">-- Chọn pin mới (chỉ pin AVAILABLE) --</option>
                                            <option th:each="bat : ${batteries.content}" th:if="${bat.status == 'AVAILABLE'}" th:value="${bat.id}" th:text="${bat.nameBattery}"></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="amount">Số tiền</label>
                                        <input type="number" step="1000" class="form-control" id="amount" th:field="*{amount}" required>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="paymentMethod">Phương thức TT</label>
                                        <select class="form-control" id="paymentMethod" th:field="*{paymentMethod}" required>
                                            <option value="CASH">Tiền mặt</option>
                                            <option value="CARD">Thẻ</option>
                                            <option value="WALLET">Ví điện tử</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="paymentStatus">Trạng thái Thanh toán</label>
                                        <select class="form-control" id="paymentStatus" th:field="*{paymentStatus}">
                                            <option value="PENDING">Chờ xử lý</option>
                                            <option value="COMPLETED">Hoàn thành</option>
                                            <option value="FAILED">Thất bại</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notes">Ghi chú</label>
                                <textarea class="form-control" id="notes" rows="3" th:field="*{notes}"></textarea>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save mr-1"></i> Lưu</button>
                            <a th:href="@{/admin/transactions}" class="btn btn-secondary">Hủy</a>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <footer th:replace="~{admin/fragments/_footer :: footer}"></footer>
</div>
<div th:replace="~{admin/fragments/_footer :: common_scripts}"></div>
</body>
</html>